Phaser.Plugin.EPSY=function(e,t){Phaser.Plugin.call(this,e,t),this.emitters=[],this.defaultTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACz0lEQVR42t2XP0hbURTGnfp/KK3QFiylCG11aRYpBQWFDiJCg266BNQtdnBQyOASQjp1KS4KGVw6iXMWEUdHUShkCBhSQpaQkJg/Jmm/H3xLEdtaWvLawMfJvfec79x77jnnvdfX96/9MpnM9VwudzOfz98qFAq3kYyZ/6tOi8XinVKpdLdSqfRXq9UHwsNarfYIyZh51tH7Y5s5Pj6+BqHI7+OsXq8/aTQag8LzZrM5JAwjGTPPOnroY4f9bzvPZrM3OBEnFPFTOXohvGy1WiPC6/Pz81FhDMmYedbRQx877OG5snPutFwu3zs7OxvQyZ6JPGSnE8KkMN1ut98KYSRjz094MyHssIcHviud3M4fE15OJuJxOZoSZoU5ISIsCIuWEc+zPoW+IzIED3y/FAnujLCxczt/JbI3Pum8sCQsCyudTmdVWEMy9vyS9cLYYe9NDMD705wgcbg7h33Ezmd8wqidrgtxISm8t4x7ns1ErT/jTYzABy/8Pyw1spcE4g4d9rDJ3ok8JiSED8KGsClsWW54nvUY+rYL+zpC8MJ/aYmyO0qILCaRfOfzPnnMJ/0opIRPwk63291FepzyetKbiNp+Cj544b80CtwRdUwpkc1OqCWHPWHybTtNS+5LHlimPb9tvYSvg5yYhQ9e+PFzWfj7aSa++0ln9bLvlvCm7GRP8lDySDhBerzn9ZT1152Yc/A5Fwbxc+EaqFPaKR3N9T7tO1xxgm04zJz0UPis/6fCFyRjbyJtPfTjro4IfPDCj58LfYEHCllKydDZ3GQWHP6kE23H4T6y05Jk1fLUkdh3TmzabtV9gmY1Cj9+8PfdBniqOQGHaa/O/kXXOaW25fAeOOycvPpVP6THJ86JXVcHdmtuVlTDGPz4wV+wItDzHOh5FfS8DwSiE/b8WdDzp2Eg3gd6/kYUiHfCQLwVB+K7IBBfRoH5Nvyvf98A3rZr7fen7G8AAAAASUVORK5CYII=",this._sortFn=function(e,t){return(e.__z||0)-(t.__z||0)};var r=this;this._onResume=function(e){for(var t=0;t<r.emitters.length;t++)r.emitters[t].lastTimestamp=Date.now()},e.onResume.add(this._onResume,this),this.game.epsy=this},Phaser.Plugin.EPSY.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.EPSY.prototype.constructor=Phaser.Plugin.EPSY,Phaser.Plugin.EPSY.VERSION="0.5.1";var updateParticle=function(e,t){t.sprite||(PIXI.Sprite.fromImage?t.sprite=PIXI.Sprite.fromImage(t.texture||this.defaultTexture):(PIXI.TextureCache=[],PIXI.BaseTextureCache=[],PIXI.Sprite.fromImage=function(e,t,r){var i=PIXI.Texture.fromImage(e,t,r);return new PIXI.Sprite(i)},PIXI.Texture.fromImage=function(e,t,r){var i=PIXI.TextureCache[e];return i||(i=new PIXI.Texture(PIXI.BaseTexture.fromImage(e,t,r)),PIXI.TextureCache[e]=i),i},PIXI.BaseTexture.fromImage=function(e,t,r){var i=PIXI.BaseTextureCache[e];if(void 0===t&&-1===e.indexOf("data:")&&(t=!0),!i){var a=new Image;t&&(a.crossOrigin=""),a.src=e,(i=new PIXI.BaseTexture(a,r)).imageUrl=e,PIXI.BaseTextureCache[e]=i,-1!==e.indexOf(PIXI.RETINA_PREFIX+".")&&(i.resolution=2)}return i},t.sprite=PIXI.Sprite.fromImage(t.texture||this.defaultTexture)),t.sprite.__parentParticle=t,t.sprite.anchor.x=.5,t.sprite.anchor.y=.5,t.sprite.tail=0,t.ready=!0),t.inserted||(t.inserted=!0,e.buffer.push(t.sprite),e.container.addChild(t.sprite)),t.sprite.width=t.radius*t.scale,t.sprite.height=t.radius*t.scale,t.sprite.position.x=t.pos.x,t.sprite.position.y=t.pos.y,t.textureAdditive?t.sprite.blendMode=PIXI.blendModes.ADD:t.sprite.blendMode=PIXI.blendModes.NORMAL,t.sprite.tint=~~t.color[2]+256*~~t.color[1]+65536*~~t.color[0],t.sprite.alpha=t.color[3]};Phaser.Plugin.EPSY.Emitter=function(e,t){PIXI.DisplayObjectContainer.call(this),this.particleSystem=e,this.emitter=t},Phaser.Plugin.EPSY.Emitter.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Phaser.Plugin.EPSY.Emitter.prototype.constructor=Phaser.Plugin.EPSY.Emitter,Phaser.Plugin.EPSY.Emitter.prototype.preUpdate=function(){},Phaser.Plugin.EPSY.Emitter.prototype.postUpdate=function(){},Phaser.Plugin.EPSY.Emitter.prototype.destroy=function(){},Phaser.Plugin.EPSY.Emitter.prototype.update=function(){var e=Date.now(),t=e-(this.__ez_parent.lastTimestamp||e);this.__ez_parent.lastTimestamp=e,t/=1e3;var r=this.emitter;r.update(t);for(var i=0;i<r.particles.length;++i){var a=r.particles[i];a.life>0&&a.color&&updateParticle.call(this.particleSystem,r,a)}},Phaser.Plugin.EPSY.Emitter.prototype.reset=function(){var e=this.emitter.buffer,t=this.emitter.container;do{var r=e.pop();r&&(t.removeChild(r),r.__parentParticle&&(r.__parentParticle.inserted=!1))}while(e.length>0)},Phaser.Plugin.EPSY.prototype.createEmitter=function(e,t,r){t=t||0,r=r||0;var i=new EPSY.Emitter(e);return i.buffer=[],i.settings.pos.x=0,i.settings.pos.y=0,this.emitters.push(i),i.container=new Phaser.Plugin.EPSY.Emitter(this,i),i.container.position.x=t,i.container.position.y=r,i.zIndex=e.zIndex,i.container.__ez_parent=i,i.lastTimestamp=Date.now(),i.container},Phaser.Plugin.EPSY.prototype.loadSystem=function(e,t,r){t=t||0,r=r||0;var i,a=game.add.group();i="string"==typeof e?JSON.parse(_data):"object"!=typeof e||e instanceof Array?e:[e];for(var n=0;n<i.length;n++){e=i[n];var s=this.createEmitter(e,e.pos.x,e.pos.y);a.add(s)}return a.position.x=t,a.position.y=r,a.children.sort(this._sortFn),a};